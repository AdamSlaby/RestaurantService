<div id="menuContent" class="row m-0 py-3 px-2">
  <div class="col-xl-6 pb-3">
    <div class="bg-white p-2" style="border-radius: 10px;">
      <h4 class="text-center mb-4">Filtrowanie</h4>
      <div class="input-group mb-3">
        <input type="text" class="form-control" [(ngModel)]="chosenMeal" placeholder="Nazwa dania bądź napoju"/>
        <button class="btn btn-outline-grey" type="button" (click)="getMealByName()">Szukaj</button>
      </div>
      <div class="mb-3">
        <select class="form-select" (ngModelChange)="getMealByType()"
                [(ngModel)]="chosenType" aria-label="Meal type select">
          <option disabled hidden [selected]="chosenType === null" [ngValue]="null">
            Wybierz typ
          </option>
          <option *ngFor="let type of types"
                  [ngValue]="type.id">{{type.name.toString()}}</option>
        </select>
      </div>
      <div class="d-flex justify-content-center align-items-center">
        <button (click)="resetFilters()" class="btn btn-outline-grey">Reset</button>
      </div>
    </div>

    <div class="bg-white p-2 mt-3" style="border-radius: 10px;">
      <h4 class="text-center mb-4">Opcje</h4>
      <div class="d-grid">
        <button class="btn btn-outline-grey mb-3" (click)="addMeal()">
          <fa-icon class="me-2" [icon]="faPlus"></fa-icon>
          <span>Dodaj nowy posiłek</span>
        </button>
        <button class="btn btn-outline-grey" (click)="addMealType(addMealTypeForm)">
          <fa-icon class="me-2" [icon]="faPlus"></fa-icon>
          <span>Dodaj nowy typ dań</span>
        </button>
      </div>
    </div>
  </div>

  <div class="col-xl-6 pb-3">
    <div class="bg-white p-2" style="border-radius: 10px;">
      <h4 class="text-center">Lista serwowanych posiłków</h4>
      <div>
        <table class="table table-striped table-hover text-center overflow-auto">
          <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col" sortable="type" (sort)="onSort($event)">Typ</th>
            <th scope="col">Nazwa</th>
            <th scope="col" sortable="price" (sort)="onSort($event)">Cena</th>
            <th scope="col">Opcje</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let meal of mealList.meals">
            <th scope="row">{{meal.id}}</th>
            <td>{{meal.type.toString()}}</td>
            <td>{{meal.name}}</td>
            <td>
              {{meal.price | currency:'PLN':'symbol-narrow':'1.2-2':'pl-PL'}}
            </td>
            <td>
              <fa-icon style="cursor: pointer" class="me-2 text-info" placement="top"
                       ngbTooltip="Zobacz pełne informacje"
                       (click)="editMeal(meal.id)" [icon]="faEye"></fa-icon>
              <fa-icon style="cursor: pointer" class="me-2 text-warning" placement="top" ngbTooltip="Edytuj"
                       (click)="editMeal(meal.id)" [icon]="faPenToSquare"></fa-icon>
              <fa-icon style="cursor: pointer" class="text-danger" placement="top" ngbTooltip="Usuń"
                       (click)="openRemoveModal(meal.id, removeMealForm)" [icon]="faXmark"></fa-icon>
            </td>
          </tr>
          </tbody>
        </table>
        <div class="d-flex justify-content-center align-items-center">
          <ngb-pagination [collectionSize]="mealList.totalElements"
                          [(page)]="pageNr"
                          [maxSize]="5"
                          [rotate]="true"
                          [boundaryLinks]="true"
                          (pageChange)="loadPage($event)"></ngb-pagination>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-lg-6 pb-3">
    <div class="bg-white p-2" style="border-radius: 10px;">
      <h4 class="text-center">Menu zimowe</h4>
      <ngb-accordion #acc="ngbAccordion" activeIds="ngb-panel-0">
        <ngb-panel *ngFor="let type of types" [title]="type.name">
          <ng-template ngbPanelContent>
            <div *ngFor="let dish of getMenuBySeason(season.WINTER).mealMap.get(type.name)" class="pb-2">
              <fa-icon (click)="removeDishFromMenu(season.WINTER, type.name, dish.id)" style="cursor: pointer"
                       class="d-inline-block me-2" [icon]="faMinus"></fa-icon>
              <span class="d-inline-block">{{dish.name}}</span>
            </div>
            <div class="input-group mb-2">
              <input [(ngModel)]="dishName" type="text" class="form-control" placeholder="Nazwa lub id potrawy">
              <button (click)="addMealToMenu(season.WINTER, type.name)" class="btn btn-outline-grey" type="button">
                <fa-icon [icon]="faPlus"></fa-icon>
              </button>
            </div>
          </ng-template>
        </ngb-panel>
      </ngb-accordion>
    </div>
  </div>

  <div class="col-xl-3 col-lg-6 pb-3">
    <div class="bg-white p-2" style="border-radius: 10px;">
      <h4 class="text-center">Menu wiosenne</h4>
      <ngb-accordion #acc="ngbAccordion" activeIds="ngb-panel-0">
        <ngb-panel *ngFor="let type of types" [title]="type.name">
          <ng-template ngbPanelContent>
            <div *ngFor="let dish of getMenuBySeason(season.SPRING).mealMap.get(type.name)" class="pb-2">
              <fa-icon (click)="removeDishFromMenu(season.SPRING, type.name, dish.id)" style="cursor: pointer"
                       class="d-inline-block me-2" [icon]="faMinus"></fa-icon>
              <span class="d-inline-block">{{dish.name}}</span>
            </div>
            <div class="input-group mb-2">
              <input [(ngModel)]="dishName" type="text" class="form-control" placeholder="Nazwa lub id potrawy">
              <button (click)="addMealToMenu(season.SPRING, type.name)" class="btn btn-outline-grey" type="button">
                <fa-icon [icon]="faPlus"></fa-icon>
              </button>
            </div>
          </ng-template>
        </ngb-panel>
      </ngb-accordion>
    </div>
  </div>

  <div class="col-xl-3 col-lg-6 pb-3">
    <div class="bg-white p-2" style="border-radius: 10px;">
      <h4 class="text-center">Menu letnie</h4>
      <ngb-accordion #acc="ngbAccordion" activeIds="ngb-panel-0">
        <ngb-panel *ngFor="let type of types" [title]="type.name">
          <ng-template ngbPanelContent>
            <div *ngFor="let dish of getMenuBySeason(season.SUMMER).mealMap.get(type.name)" class="pb-2">
              <fa-icon (click)="removeDishFromMenu(season.SUMMER, type.name, dish.id)" style="cursor: pointer"
                       class="d-inline-block me-2" [icon]="faMinus"></fa-icon>
              <span class="d-inline-block">{{dish.name}}</span>
            </div>
            <div class="input-group mb-2">
              <input [(ngModel)]="dishName" type="text" class="form-control" placeholder="Nazwa lub id potrawy">
              <button (click)="addMealToMenu(season.SUMMER, type.name)" class="btn btn-outline-grey" type="button">
                <fa-icon [icon]="faPlus"></fa-icon>
              </button>
            </div>
          </ng-template>
        </ngb-panel>
      </ngb-accordion>
    </div>
  </div>

  <div class="col-xl-3 col-lg-6 pb-3">
    <div class="bg-white p-2" style="border-radius: 10px;">
      <h4 class="text-center">Menu jesienne</h4>
      <ngb-accordion #acc="ngbAccordion" activeIds="ngb-panel-0">
        <ngb-panel *ngFor="let type of types" [title]="type.name">
          <ng-template ngbPanelContent>
            <div *ngFor="let dish of getMenuBySeason(season.AUTUMN).mealMap.get(type.name)" class="pb-2">
              <fa-icon (click)="removeDishFromMenu(season.AUTUMN, type.name, dish.id)" style="cursor: pointer"
                       class="d-inline-block me-2" [icon]="faMinus"></fa-icon>
              <span class="d-inline-block">{{dish.name}}</span>
            </div>
            <div class="input-group mb-2">
              <input [(ngModel)]="dishName" type="text" class="form-control" placeholder="Nazwa lub id potrawy">
              <button (click)="addMealToMenu(season.AUTUMN, type.name)" class="btn btn-outline-grey" type="button">
                <fa-icon [icon]="faPlus"></fa-icon>
              </button>
            </div>
          </ng-template>
        </ngb-panel>
      </ngb-accordion>
    </div>
  </div>
</div>

<ng-template #removeMealForm let-modal>
  <div class="modal-header">
    <h4 class="modal-title" >Czy usunąć posiłek o identyfikatorze {{selectedMealId}}?</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <div class="d-flex justify-content-center align-items-center">
      <button type="button" class="btn btn-outline-success me-4" (click)="removeMeal(removeMealForm)">Tak</button>
      <button type="button" class="btn btn-outline-danger" (click)="modal.close()">Anuluj</button>
    </div>
  </div>
</ng-template>

<ng-template #addMealTypeForm let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Typy posiłków</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <ng-container *ngFor="let type of types">
      <div class="input-group mb-2">
        <input [(ngModel)]="type.name" type="text" class="form-control" placeholder="Wpisz nazwę typu">
        <button (click)="editType(type)" class="btn btn-outline-grey" type="button">
          <fa-icon [icon]="faPenToSquare"></fa-icon>
        </button>
      </div>
      <div *ngIf="error" class="invalid-feedback d-block">
        <div class="d-flex justify-content-center align-items-center">
          {{error}}
        </div>
      </div>
    </ng-container>
    <div class="input-group mb-2">
      <input [(ngModel)]="typeName" type="text" class="form-control" placeholder="Wpisz nazwę nowego typu">
      <button (click)="addType()" class="btn btn-outline-grey" type="button">
        <fa-icon [icon]="faPlus"></fa-icon>
      </button>
    </div>
    <div *ngIf="error" class="invalid-feedback d-block">
      <div class="d-flex justify-content-center align-items-center">
        {{error}}
      </div>
    </div>
  </div>
</ng-template>
